# -*- coding: utf-8 -*-
"""ëŸ¬êµë¡  ì‚¬ì´íŠ¸

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Bw4WZCs7g8WDXOD8KKVoeMEGw9Qnkxh4
"""

import re
import streamlit as st
from pymystem3 import Mystem
from googletrans import Translator

st.set_page_config(page_title="ëŸ¬ì‹œì•„ì–´ í…ìŠ¤íŠ¸ ë¶„ì„ê¸°", layout="wide")
st.title("ëŸ¬ì‹œì•„ì–´ í…ìŠ¤íŠ¸ ë¶„ì„ê¸°")

# ì´ˆê¸°í™”
if "clicked_word" not in st.session_state:
    st.session_state.clicked_word = None

# ë„êµ¬
mystem = Mystem()
translator = Translator()

@st.cache_data(show_spinner=False)
def lemmatize_ru(word: str) -> str:
    lemmas = mystem.lemmatize(word)
    return (lemmas[0] if lemmas else word).strip()

@st.cache_data(show_spinner=False)
def translate_ru_ko(word: str) -> str:
    try:
        return translator.translate(word, src="ru", dest="ko").text
    except Exception:
        return "(ë²ˆì—­ ì‹¤íŒ¨)"

# ì…ë ¥
text = st.text_area("í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”", "Ğ§ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ¸Ğ´Ñ‘Ñ‚ Ğ¿Ğ¾ ÑƒĞ»Ğ¸Ñ†Ğµ. Ğ­Ñ‚Ğ¾ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ°.")

# í† í°í™” (ë‹¨ì–´/ë¬¸ì¥ë¶€í˜¸ ë¶„ë¦¬, ê³µë°±ì€ ì¶œë ¥ ì‹œ ì²˜ë¦¬)
tokens = re.findall(r"\w+|[^\w\s]", text, flags=re.UNICODE)

left, right = st.columns([2, 1], gap="large")

with left:
    st.subheader("í…ìŠ¤íŠ¸ ë¶„ì„ ê²°ê³¼")
    st.caption("ë‹¨ì–´ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì˜¤ë¥¸ìª½ì— ê¸°ë³¸í˜•(lemma)ê³¼ í•œêµ­ì–´ ëœ»ì´ í‘œì‹œë©ë‹ˆë‹¤.")
    # ë‹¨ì–´ëŠ” ë²„íŠ¼(ì„¸ë¡œ ë°°ì—´), ë¶€í˜¸ëŠ” ê·¸ëŒ€ë¡œ í‘œì‹œ
    for i, tok in enumerate(tokens):
        if re.match(r"\w+", tok, flags=re.UNICODE):
            if st.button(tok, key=f"tok_{i}"):
                st.session_state.clicked_word = tok
        else:
            st.markdown(tok)

    # ìœ í‹¸: ìƒíƒœ ì´ˆê¸°í™”
    with st.expander("ì´ˆê¸°í™”"):
        if st.button("ğŸ”„ ì„ íƒ ì´ˆê¸°í™”"):
            st.session_state.clicked_word = None
            st.rerun()

with right:
    st.subheader("ğŸ“š ë‹¨ì–´ ì •ë³´")
    cw = st.session_state.clicked_word
    if cw:
        lemma = lemmatize_ru(cw)
        meaning = translate_ru_ko(cw)
        st.markdown(f"**ì„ íƒëœ ë‹¨ì–´:** {cw}")
        st.markdown(f"**ê¸°ë³¸í˜•(lemma):** *{lemma}*")
        st.markdown(f"**í•œêµ­ì–´ ëœ»:** {meaning}")
    else:
        st.info("ì™¼ìª½ì—ì„œ ë‹¨ì–´ë¥¼ í´ë¦­í•˜ë©´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.")

# ë³´ì¡°: ì§ì ‘ ê²€ìƒ‰
st.divider()
st.subheader("ğŸ” ì§ì ‘ ê²€ìƒ‰")
q = st.text_input("ë‹¨ì–´ë¥¼ ì§ì ‘ ì…ë ¥í•´ ê²€ìƒ‰í•  ìˆ˜ë„ ìˆì–´ìš”.", "")
if q:
    lemma = lemmatize_ru(q)
    meaning = translate_ru_ko(q)
    st.markdown(f"**ì…ë ¥ ë‹¨ì–´:** {q}")
    st.markdown(f"**ê¸°ë³¸í˜•(lemma):** *{lemma}*")
    st.markdown(f"**í•œêµ­ì–´ ëœ»:** {meaning}")
